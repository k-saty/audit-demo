<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Audit Demo Dashboard</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <main>
      <h1>Conversation Audit Logs</h1>

      <section id="create">
        <h2>Create log</h2>
        <form id="logForm">
          <label>Tenant ID: <input name="tenant_id" required /></label>
          <label>Agent ID: <input name="agent_id" required /></label>
          <label>Session ID: <input name="session_id" required /></label>
          <label>Channel: <input name="channel" required /></label>
          <label>Prompt: <textarea name="prompt" required></textarea></label>
          <label>Response: <textarea name="response" required></textarea></label>
          <button type="submit">Send log</button>
        </form>
        <div id="createResult"></div>
      </section>

      <section id="list">
        <h2>View logs</h2>
        <label>Tenant ID: <input id="queryTenant" /></label>
        <button id="fetchLogs">Fetch logs</button>
        <div id="logsCount"></div>
        <table id="logsTable">
          <thead><tr><th>ID</th><th>Timestamp</th><th>Agent</th><th>Session</th><th>Channel</th><th>Prompt</th><th>Response</th></tr></thead>
          <tbody></tbody>
        </table>
      </section>

      <section id="pii">
        <h2>PII Detection Dashboard</h2>
        
        <div class="card">
          <h3>PII Summary</h3>
          <label>Tenant ID: <input id="piiTenant" /></label>
          <button id="fetchPiiSummary">View PII Summary</button>
          <div id="piiSummaryResult"></div>
        </div>

        <div class="card">
          <h3>All PII Detections</h3>
          <label>Tenant ID (optional): <input id="piiLogsFilter" /></label>
          <label>Risk Level: 
            <select id="piiRiskFilter">
              <option value="">All</option>
              <option value="high">High Risk Only</option>
              <option value="medium">Medium Risk Only</option>
              <option value="low">Low Risk Only</option>
            </select>
          </label>
          <button id="fetchPiiLogs">Fetch PII Logs</button>
          <div id="piiLogsCount"></div>
          <table id="piiLogsTable">
            <thead><tr><th>Detection ID</th><th>Timestamp</th><th>PII Count</th><th>High Risk</th><th>PII Types</th><th>Action</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="card" id="piiDetailsCard" style="display: none;">
          <h3>PII Details</h3>
          <button id="closePiiDetails" style="float: right;">Close</button>
          <div id="piiDetailsContent"></div>
        </div>
      </section>

      <section id="compliance">
        <h2>ðŸ“¦ Compliance Export Pack</h2>
        <p style="color: #666; font-size: 14px;">Generate audit-ready compliance artifacts in one click. Perfect for regulatory compliance (GDPR, HIPAA, SOC2, etc.)</p>
        
        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
          <h3 style="color: white; margin-top: 0;">1-Click Compliance Export</h3>
          <p>Generate a complete compliance pack containing:</p>
          <ul style="margin: 10px 0;">
            <li>âœ“ Conversation logs (CSV) - All audit data</li>
            <li>âœ“ PII detection logs (CSV) - All detected risks</li>
            <li>âœ“ Data sources manifest (JSON) - Complete data lineage</li>
            <li>âœ“ Model information (JSON) - Detection methodology</li>
            <li>âœ“ Retention policy (JSON) - Data governance settings</li>
            <li>âœ“ Compliance metadata (JSON) - Audit trail & timestamps</li>
          </ul>
          
          <form id="complianceExportForm" style="margin-top: 20px;">
            <label style="color: white; font-weight: bold;">Tenant ID: 
              <input id="complianceTenantId" required style="padding: 8px; border-radius: 4px; border: none; color: #333;" />
            </label>
            <button type="submit" style="background-color: #fff; color: #667eea; font-weight: bold; margin-top: 10px;">
              ðŸ“¥ Download Compliance Pack
            </button>
          </form>
          <div id="complianceExportResult" style="margin-top: 15px;"></div>
        </div>
      </section>

      <section id="admin">
        <h2>Admin â€” Retention & Deletion Audits</h2>

        <div class="card">
          <h3>Set per-tenant retention</h3>
          <form id="retentionForm">
            <label>Tenant ID: <input name="tenant_id" required /></label>
            <label>Retention days:
              <select name="retention_days">
                <option value="30">30</option>
                <option value="90" selected>90</option>
                <option value="180">180</option>
              </select>
            </label>
            <button type="submit">Set retention</button>
          </form>
          <div id="retentionResult"></div>
        </div>

        <div class="card">
          <h3>View deletion audits</h3>
          <label>Tenant ID (optional): <input id="auditTenant" /></label>
          <button id="fetchAudits">Fetch deletion audits</button>
          <button id="runCleanup">Run cleanup (demo only)</button>
          <div id="auditsCount"></div>
          <table id="auditsTable">
            <thead><tr><th>ID</th><th>Tenant</th><th>Retention</th><th>Deleted Before</th><th>Deleted Count</th><th>Run Timestamp</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>

    <script src="/static/main.js"></script>
  </body>
</html>
